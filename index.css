@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  background-color: #1a1a1a;
  color: #e5e5e5;
  font-family: 'Courier Prime', monospace;
  overflow: hidden;
  transition: background-color 0.5s ease, color 0.5s ease;
}

/* Scrollbars Personalizados (Dark Theme) */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-track {
  background: transparent; 
}
::-webkit-scrollbar-thumb {
  background: #3f3f46; 
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: #52525b; 
}

/* Fondo tipo Corcho Oscuro */
.cork-pattern {
  background-color: #18181b; /* Zinc 950 */
  background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
  background-size: 40px 40px;
  background-position: 0 0, 20px 20px;
  box-shadow: inset 0 0 200px rgba(0,0,0,0.95);
  transition: background-color 0.5s ease;
}

/* Fondo Pizarra (Blackboard) */
.blackboard-pattern {
  background-color: #27272a;
  background-image: 
    linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 100px 100px;
  box-shadow: inset 0 0 150px rgba(0,0,0,0.8);
  transition: background-color 0.5s ease;
}

/* Fondo Papel Milimetrado (Graph Paper) */
.graph-paper-pattern {
  background-color: #1e293b; /* Slate 800 (Oscuro por defecto) */
  background-image: 
    linear-gradient(#334155 1px, transparent 1px),
    linear-gradient(90deg, #334155 1px, transparent 1px);
  background-size: 20px 20px;
  transition: background-color 0.5s ease;
}

/* Estilo para el hilo rojo */
.react-flow__edge-path {
  stroke: #dc2626; /* Un rojo más oscuro y realista */
  stroke-width: 2;
  filter: url(#yarn-texture) drop-shadow(2px 3px 2px rgba(0,0,0,0.6)); /* Textura de lana + Sombra */
  /* Animación de tensado (dibujado) */
  stroke-dasharray: 5000;
  stroke-dashoffset: 0;
  animation: draw-thread 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
  transition: stroke-width 0.3s ease, filter 0.3s ease;
}

/* OPTIMIZACIÓN: Desactivar filtros pesados durante el movimiento */
.is-moving .react-flow__edge-path {
  filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5)) !important; /* Sombra simple, sin textura de lana */
  transition: none !important;
  will-change: transform;
}

/* Estilo de la línea mientras la estás arrastrando */
.react-flow__connection-path {
  stroke: var(--connection-color, #dc2626);
  stroke-width: 2;
  stroke-dasharray: 5;
  animation: dash-draw 0.5s linear infinite;
  filter: drop-shadow(0 0 2px var(--connection-color, #dc2626));
}

@keyframes dash-draw {
  from { stroke-dashoffset: 10; }
  to { stroke-dashoffset: 0; }
}

.react-flow__handle {
  background: transparent;
  border: none;
  border-radius: 50%;
}

/* Clase utilitaria para el Clavo 3D */
.pin-3d {
  background: radial-gradient(circle at 35% 35%, #fca5a5, #dc2626, #7f1d1d);
  box-shadow: 3px 5px 6px rgba(0,0,0,0.5), inset 0 0 2px rgba(0,0,0,0.5);
  border: 1px solid #7f1d1d;
  position: relative;
}
.pin-3d::after {
  content: '';
  position: absolute;
  top: 25%;
  left: 25%;
  width: 20%;
  height: 20%;
  background: radial-gradient(circle, rgba(255,255,255,0.9), rgba(255,255,255,0.4));
  border-radius: 50%;
  filter: blur(0.3px);
}

/* Personalización de los controles (Zoom, Fit, Lock) para modo oscuro */
.react-flow__controls {
  background-color: #27272a; /* zinc-800 */
  border: 1px solid #3f3f46; /* zinc-700 */
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
}

.react-flow__controls-button {
  background-color: #27272a;
  border-bottom: 1px solid #3f3f46;
  color: #e5e5e5; /* Iconos claros */
  transition: background-color 0.2s ease, color 0.2s ease;
}

.react-flow__controls-button svg {
  fill: currentColor !important;
}

.react-flow__controls-button:hover {
  background-color: #3f3f46; /* zinc-700 */
  color: #ffffff;
}

/* Caja de Selección Personalizada (Estilo Policial) */
.react-flow__selection {
  background: rgba(234, 179, 8, 0.05) !important;
  border: 1px dashed #eab308 !important;
  box-shadow: 0 0 15px rgba(234, 179, 8, 0.1);
  border-radius: 4px;
}

/* Bloqueo total del tablero (Modo Lectura) */
.board-locked .react-flow__node,
.board-locked .react-flow__edge {
  pointer-events: none !important;
}

/* Estilos para Modo Claro */
.light-mode .cork-pattern {
  background-color: #e5e5e5;
  background-image: radial-gradient(#999 1px, transparent 1px), radial-gradient(#999 1px, transparent 1px);
  box-shadow: inset 0 0 100px rgba(0,0,0,0.1);
}

.light-mode .blackboard-pattern {
  /* Inversión para modo claro si se selecciona pizarra (se convierte en pizarra blanca) */
  background-color: #ffffff;
  background-image: radial-gradient(#e5e7eb 2px, transparent 2px);
  background-size: 30px 30px;
}

.light-mode .graph-paper-pattern {
  background-color: #f0f9ff; /* Azul muy pálido */
  background-image: 
    linear-gradient(#cbd5e1 1px, transparent 1px),
    linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
}

.light-mode .react-flow__controls {
  background-color: #ffffff;
  border: 1px solid #e5e7eb;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.light-mode .react-flow__controls-button {
  background-color: #ffffff;
  border-bottom: 1px solid #e5e7eb;
  color: #374151;
}

.light-mode .react-flow__controls-button:hover {
  background-color: #f3f4f6;
  color: #000000;
}

.light-mode .text-node-content {
  color: #18181b;
}

/* --- ANIMACIONES --- */

/* Animación de golpe para los sellos */
@keyframes stamp-hit {
  0% {
    opacity: 0;
    transform: scale(3);
  }
  70% {
    transform: scale(0.85);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 0.9;
  }
}

.stamp-animation {
  animation: stamp-hit 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* 1. Animación del hilo tensándose */
@keyframes draw-thread {
  from {
    stroke-dashoffset: 5000;
    opacity: 0;
  }
  to {
    stroke-dashoffset: 0;
    opacity: 1;
  }
}

/* 2. Animación de entrada para los nodos (Pop-in suave) */
@keyframes node-enter {
  from {
    opacity: 0;
    transform: scale(0.8) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Aplicar animación a todos los nodos personalizados */
.react-flow__node > div {
  animation: node-enter 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

/* 3. Efecto en los puntos de conexión (clavos) al hacer hover */
.react-flow__handle:hover {
  transform: scale(1.2);
  transition: transform 0.2s ease;
  cursor: crosshair;
  box-shadow: 0 0 8px rgba(220, 38, 38, 0.6);
}

/* NUEVO: Estilos para etiquetas de hilos HTML (Compatible con exportación) */
.custom-edge-label {
  background-color: #18181b;
  color: #ffffff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 700;
  border: 1px solid #3f3f46;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  font-family: 'Courier Prime', monospace;
}

.light-mode .custom-edge-label {
  background-color: #ffffff;
  color: #000000;
  border-color: #e5e7eb;
}

/* Animación rápida para conexión rápida */
.quick-draw .react-flow__edge-path {
  animation-duration: 0.3s !important;
}

/* Animación de iluminación para conexiones seleccionadas */
@keyframes edge-pulse {
  0%, 100% {
    stroke-width: 2;
    filter: drop-shadow(3px 5px 3px rgba(0,0,0,0.7));
  }
  50% {
    stroke-width: 4;
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)) brightness(1.2);
  }
}

/* Aumentamos especificidad para asegurar que gane sobre quick-draw */
.react-flow__edge.animated-flow .react-flow__edge-path {
  animation: edge-pulse 1.5s ease-in-out infinite !important;
  animation-duration: 1.5s !important; /* Forzar duración para evitar conflictos */
}

/* Efecto hover para iluminar hilos al pasar el mouse */
.react-flow__edge:hover .react-flow__edge-path {
  stroke-width: 4 !important;
  filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)) brightness(1.5);
  cursor: pointer;
}

/* --- EFECTOS ATMOSFÉRICOS --- */

/* 1. Grano de Película (Film Grain) */
@keyframes grain {
  0%, 100% { transform: translate(0, 0); }
  10% { transform: translate(-5%, -10%); }
  20% { transform: translate(-15%, 5%); }
  30% { transform: translate(7%, -25%); }
  40% { transform: translate(-5%, 25%); }
  50% { transform: translate(-15%, 10%); }
  60% { transform: translate(15%, 0%); }
  70% { transform: translate(0%, 15%); }
  80% { transform: translate(3%, 35%); }
  90% { transform: translate(-10%, 10%); }
}

.film-grain {
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  pointer-events: none;
  z-index: 20;
  opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  animation: grain 8s steps(10) infinite;
}

.light-mode .film-grain {
  opacity: 0.15;
  filter: invert(1);
}

/* 2. Textura de Papel */
.paper-texture {
  background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E");
}

/* 3. Cinta Adhesiva */
.tape-visual {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%) rotate(-2deg);
  width: 80px;
  height: 25px;
  background-color: rgba(255, 255, 255, 0.12);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  backdrop-filter: blur(1.5px);
  z-index: 40;
  pointer-events: none;
  opacity: 0.9;
  mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
}

/* 4. Borde irregular para notas (Efecto papel cortado) */
.note-rough {
  clip-path: polygon(2% 0%, 98% 1%, 100% 98%, 1% 99%);
}

/* Optimización general del viewport */
.react-flow__viewport {
  will-change: transform;
}

/* --- ANIMACIONES DE ELIMINACIÓN --- */

@keyframes delete-crumple {
  0% { transform: scale(1) rotate(0deg); opacity: 1; }
  20% { transform: scale(0.9) rotate(-5deg); }
  40% { transform: scale(0.8) rotate(5deg); }
  60% { transform: scale(0.6) rotate(-10deg); }
  100% { transform: scale(0) rotate(20deg); opacity: 0; }
}

@keyframes delete-scale {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(0); opacity: 0; }
}

@keyframes delete-fade {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes delete-burn {
  0% { filter: contrast(1) brightness(1) sepia(0) grayscale(0); opacity: 1; transform: scale(1); }
  40% { filter: contrast(2) brightness(1.5) sepia(1) saturate(5) hue-rotate(-30deg); opacity: 0.9; }
  100% { filter: contrast(2) brightness(0) sepia(1) grayscale(1) blur(8px); opacity: 0; transform: scale(0.9); }
}

.deleting-image {
  animation: delete-burn 0.5s ease-in-out forwards !important;
  pointer-events: none !important;
}

.deleting-note {
  animation: delete-crumple 0.5s ease-in-out forwards !important;
  pointer-events: none !important;
}

.deleting-default {
  animation: delete-scale 0.4s ease-in forwards !important;
  pointer-events: none !important;
}

.deleting-zone {
  animation: delete-fade 0.3s ease-out forwards !important;
  pointer-events: none !important;
}

.deleting-edge {
  opacity: 0 !important;
  transition: opacity 0.3s ease-out !important;
  pointer-events: none !important;
}